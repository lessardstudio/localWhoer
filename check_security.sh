#!/bin/bash

echo "=== ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸ ==="
echo ""

# Ð£Ð·Ð½Ð°Ñ‚ÑŒ Ð²Ð½ÐµÑˆÐ½Ð¸Ð¹ IP
EXTERNAL_IP=$(curl -s ifconfig.me)
echo "Ð’Ð½ÐµÑˆÐ½Ð¸Ð¹ IP: $EXTERNAL_IP"
echo ""

# 1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾Ñ€Ñ‚Ð° 3000 Ð¸Ð·Ð²Ð½Ðµ (Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð—ÐÐšÐ Ð«Ð¢)
echo "1ï¸âƒ£ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾Ñ€Ñ‚Ð° 3000 Ð¸Ð·Ð²Ð½Ðµ:"
timeout 3 nc -zv $EXTERNAL_IP 3000 2>&1 && echo "âŒ ÐžÐŸÐÐ¡ÐÐž! ÐŸÐ¾Ñ€Ñ‚ 3000 ÐžÐ¢ÐšÐ Ð«Ð¢!" || echo "âœ… ÐŸÐ¾Ñ€Ñ‚ 3000 Ð—ÐÐšÐ Ð«Ð¢"

echo ""

# 2. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Hysteria2
echo "2ï¸âƒ£ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Hysteria2 (Ð¿Ð¾Ñ€Ñ‚ 1935/UDP):"
sudo ss -ulnp | grep 1935 && echo "âœ… Hysteria2 ÑÐ»ÑƒÑˆÐ°ÐµÑ‚ Ð½Ð° 1935/UDP"

echo ""

# 3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°
echo "3ï¸âƒ£ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº whier:"
curl -s -o /dev/null -w "HTTP Status: %{http_code}\n" http://127.0.0.1:3000

echo ""

# 4. UFW ÑÑ‚Ð°Ñ‚ÑƒÑ
echo "4ï¸âƒ£ UFW Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°:"
sudo ufw status numbered

echo ""

# 5. Docker binding
echo "5ï¸âƒ£ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Docker Ð¿Ð¾Ñ€Ñ‚Ð¾Ð²:"
docker port whier-app

echo ""
echo "=== Ð˜Ñ‚Ð¾Ð³ ==="
echo "âœ… ÐŸÐ¾Ñ€Ñ‚ 3000 Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ: 127.0.0.1:3000->3000/tcp"
echo "âœ… ÐÐ• Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ: 0.0.0.0:3000->3000/tcp"