#!/bin/bash

echo "=== üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ VPN —Å–µ—Ç–∏ ==="
echo ""

# –£–∑–Ω–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π IP
EXTERNAL_IP=$(curl -s ifconfig.me)
echo "üåê –í–Ω–µ—à–Ω–∏–π IP —Å–µ—Ä–≤–µ—Ä–∞: $EXTERNAL_IP"
echo ""

# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞ 3000 –∏–∑–≤–Ω–µ
echo "1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç–∞ 3000 –ò–ó–í–ù–ï:"
# –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞ 2 —Å–µ–∫—É–Ω–¥—ã
if timeout 2 bash -c "cat < /dev/null > /dev/tcp/$EXTERNAL_IP/3000" 2>/dev/null; then
    echo "‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê! –ü–æ—Ä—Ç 3000 –û–¢–ö–†–´–¢ –¥–ª—è –≤—Å–µ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞!"
    echo "–°—Ä–æ—á–Ω–æ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ docker-compose.yml –∏ UFW."
else
    echo "‚úÖ –ü–æ—Ä—Ç 3000 –ó–ê–ö–†–´–¢ –∏–∑–≤–Ω–µ (—ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ)."
fi

echo ""

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ Hysteria2
echo "2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ Hysteria2 (–ø–æ—Ä—Ç 1935/UDP):"
HY_STATUS=$(sudo ss -ulnp | grep 1935)
if [ -n "$HY_STATUS" ]; then
    echo "‚úÖ Hysteria2 —Å–ª—É—à–∞–µ—Ç –Ω–∞ 1935/UDP"
    echo "$HY_STATUS"
else
    echo "‚ùå –û–®–ò–ë–ö–ê: Hysteria2 –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 1935/UDP!"
fi

echo ""

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
echo "3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (–≤–Ω—É—Ç—Ä–∏ —Å–µ—Ä–≤–µ—Ä–∞):"
HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" http://127.0.0.1:3000 || echo "FAILED")
if [ "$HTTP_CODE" = "200" ] || [ "$HTTP_CODE" = "404" ] || [ "$HTTP_CODE" = "301" ]; then
    echo "‚úÖ whier-app –æ—Ç–≤–µ—á–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ (HTTP Status: $HTTP_CODE)"
else
    echo "‚ùå –û–®–ò–ë–ö–ê: whier-app –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –¥–∞–∂–µ –ª–æ–∫–∞–ª—å–Ω–æ (Status: $HTTP_CODE)"
fi

echo ""

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker Binding
echo "4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker Binding (—Å—Ç—Ä–æ–≥–æ 127.0.0.1):"
DOCKER_PORT=$(docker port whier-app 3000 2>/dev/null || echo "NOT_FOUND")
if [[ $DOCKER_PORT == *"127.0.0.1"* ]]; then
    echo "‚úÖ Docker: –ø–æ—Ä—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ localhost ($DOCKER_PORT)"
elif [[ $DOCKER_PORT == *"0.0.0.0"* ]]; then
    echo "‚ùå –û–ü–ê–°–ù–û: Docker –ø—Ä–∏–≤—è–∑–∞–Ω –∫ 0.0.0.0 (–æ—Ç–∫—Ä—ã—Ç –º–∏—Ä—É)!"
else
    echo "‚ö†Ô∏è  Docker: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä whier-app –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –ø–æ—Ä—Ç –Ω–µ –ø—Ä–æ–±—Ä–æ—à–µ–Ω."
fi

echo ""
echo "=== üìã –ò–¢–û–ì–û–í–´–ô –ß–ï–ö-–õ–ò–°–¢ ==="
echo "1. –í –±—Ä–∞—É–∑–µ—Ä–µ http://$EXTERNAL_IP:3000 ‚Äî –ù–ï –¥–æ–ª–∂–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è."
echo "2. –í –∫–ª–∏–µ–Ω—Ç–µ Hiddify (—á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏) ‚Äî –î–û–õ–ñ–ù–û –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è."